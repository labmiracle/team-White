## Get the code

```
eval $(ssh-agent )
ssh-add /root/.ssh/deploy-miracledevs_ed25519
git clone git@github.com:MiracleDevs/Paradigm.Express.WebApi.Bootstrap
```

## Or update the local copy

```
eval $(ssh-agent )
ssh-add /root/.ssh/deploy-miracledevs_ed25519
cd ParadigmAPI
git pull
```

## Rebuild the docker images

Once the code is updated, we need to rebuild the images uses on the docker-compose project, we can do this with the following commands

```
cd ParadigmAPI/docker
docker-compose build
```

note, that will update the images used on the project, but dose not affects the running container. To update the container is required to issue a restart command or to force this operation is posible to run

```
cd ParadigmAPI/docker
docker-compose up -d --build --force-recreate
```

## Docker deploy configuration

The current code on the docker directory is for development. For the Linode deploy we recommend remove the ports entry for all the services, except for the nginx services.
Also on the docker/.env file you can find the DATABASE_PASSWORD witch may be required to access the database. This has been random generated in case the database must be accessed from external networks.

## Starting the project

```
cd ParadigmAPI/docker
docker-compose up -d
```

## Review the logs

```
cd ParadigmAPI/docker
docker-compose logs -f
```

## Backup the docker volume

the following command is an example, witch runs a docker with interactive terminal (-it), it will remove the container after it runs (--rm) witch maps the docker_db_data, witch is the name of the volume generated by the docker-compose project, and other directory as the copy destination, after the ubuntu image is the copy command witch will run.

```
docker run -it --rm -v docker_db_data:/source -v $(pwd)/destination:/destination ubuntu cp -rf /source /destination
```

After the command terminates, inside the destination directory will be a copy of the docker_db_data content, witch in this case should be a Mysql database, since is mapped to /var/lib/mysql on mysql service.

other option is to run mysql-dump from the database container, this can be run from any directory and generates standard output, and can be redirected with a pipe (|) or stdout redirect (>> filename)

```
docker exec -it docker_database_1 mysqldump -uroot -p${DATABASE_PASSWORD} --databases paradigm_api_db --skip-comments  | tee backup.sql
```
